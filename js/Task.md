# 実装タスク

* バトラーはモードを持つ
* バトラーはモードチェンジできる
    * モードが切り替わるとステートも切り替わる
* 自分や相手のモードに応じて攻撃魔法の効果が変わる
* 敵はプレイヤー側の弱点を探ってくる
* 敵は弱点がプレイヤーにバレたと思うとモードチェンジする
* メタタグで敵の使うスキルを設定できる

## 自分や相手のモードに応じて攻撃魔法の効果が変わる

効き目レベルに応じて効果が違う

* +2 で即死
* +1 で追加ダメージ
* -1以下 で反射される

効き目レベルの変動ルール

* 自分のモードに対応する属性魔法を使ったときは +1
* 相手のモードの逆に対応する属性魔法を使ったときは +1 (弱点)
* 相手のモードに対応する属性魔法を使ったときは -2 (抵抗)

## 敵はプレイヤー側の弱点を探ってくる

敵からプレイヤーへの攻撃で探ってくる

* 単色魔法によるテスト
    * 弱点を引き当てたら、以後はその属性でその対象に攻撃
    * 抵抗を引き当てたら、以後はその逆属性でその対象に攻撃
    * 弱点を引き当てなかったら、以後はその属性でその対象へは攻撃しない
* 二色魔法によるテスト
    * 弱点を引き当てたら、以後はその時使わなかった属性でその対象へは攻撃しない
    * 抵抗を引き当てたら、以後はその時使わなかった属性でその対象へは攻撃しない
    * 弱点を引き当てなかったら、以後はその属性でその対象へは攻撃しない

プレイヤーから敵への攻撃で探ってくる

* プレイヤーの攻撃で敵が即死すると、以後は敵はその逆属性でその対象に攻撃

## 敵は弱点がプレイヤーにバレたと思うとモードチェンジする

敵の性格に応じていくつかパターンが有る

* 弱点と抵抗を入れ替えるタイプ
    * そのまま弱点を突くと反射される
    * 逆属性で攻撃するだけで倒せる
* 全く関係のない属性にモードチェンジする
    * 単に時間を稼がれる

## メタタグで敵の使うスキルを設定できる

敵に設定できるスキルは2種類。

* 属性魔法
* モードチェンジ

それぞれは通常のスキルで、スキルIDを持つ。

メタタグでスキルを列挙すると、敵のAIがそのスキルを行動の判断に組み込む。メタタグはカンマ区切りでスキルを列挙でき、例えば以下の通り：

```
<AvailableSkill:3,4,10,19>
```

## 敵の初期モードを設定できる

敵の初期モードを以下のように指定できる：

```
<InitialMode:4>
```

# 実装アイデア

## モード

モードはスクリプト側に持つ。さもないと弱点の判定で関係のないステートを含めていちいちチェックする必要がある。

モードチェンジスキルは通常のスキルで、モードステートを変更する。モードステートの変更をスクリプト側でフックして、モードの変数を書き換える。

## 弱点ばれ

また、弱点ばれ情報もスクリプト側に持つ。敵の情報までスイッチで持つと収集がつかない。

弱点ばれ情報は Battler に持ち、初期化する場所は Game_Troop.initialize がよさそう。

弱点が完全にばれるとステートで知らせる。ステートの種類は以下の通り

|アクター|敵|
|-|-|
|弱点ばれ(アイコン)|○○弱点ばれ(アイコン)|
|○○モード(アイコン)|○○モード(アイコンなし)|